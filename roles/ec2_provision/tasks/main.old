---
- name: Provision AWS EC2 Instance
  hosts: localhost
  connection: local
  gather_facts: false
  tasks:
#   - name: Create EC2 Key Pair
#     amazon.aws.ec2_key:
#       name: my_key_pair
#       region: us-east-1
#       state: present
#       key_material: "{{ lookup('file', 'my_key_pair.pem') }}"
#   - name: Create Security Group
#     amazon.aws.ec2_security_group:
#       name: web_sg
#       description: Web server security group
#       region: us-east-1
#       rules:
#         - proto: all
#           cidr_ip: 0.0.0.0/0
#       state: present
    - name: Launch EC2 Instance
      amazon.aws.ec2_instance:
        name: my_server
        image_id: ami-0360c520857e3138f 
        instance_type: t3.small
        region: us-east-1
        key_name: "{{ hostvars['localhost']['key_name']}}"
        security_groups:
          - my_sg
        state: present
